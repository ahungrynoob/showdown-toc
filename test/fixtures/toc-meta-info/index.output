<blockquote>
  <p>å‰æ®µæ—¶é—´ï¼Œç¼–å†™è‡ªå·±åšå®¢é¡¹ç›®çš„æ—¶å€™ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå…¨å±€çŠ¶æ€ç®¡ç†ï¼Œæ„Ÿè§‰reduxåˆå¤ªé‡äº†ï¼Œå°±è‡ªå·±åŸºäºhookæä¸€ä¸ªå§ï¼Œæ‡’å¾—è£…reduxäº†</p>
</blockquote>
<p>ğŸ‰ğŸ‰ğŸ‰ æœ¬æ–‡ç®€å•ä»‹ç»ä¸‹åŸç†ï¼Œä¼¸æ‰‹å…šå¯ç›´æ¥é£Ÿç”¨ï¼š<a href="https://github.com/ahungrynoob/use-root-reducer">use-root-reducer</a></p>
<p>âš ï¸å…ˆè¯´ä¸€ä¸ªå¤§å‰æï¼š reduxå·²ç»æœ‰å®Œå–„çš„ç¤¾åŒºï¼Œå’Œå¾ˆå¤šçš„middleware, hookså¹¶ä¸æ˜¯reduxçš„æ›¿ä»£å“ï¼Œåœ¨å¤§å‹webappçš„å¼€å‘ä¸­ï¼Œè¿˜æ˜¯ä½¿ç”¨reduxæ¥ç®¡ç†æ¯”è¾ƒå¥½</p>
<h2 id="usereducerå’Œreduxçš„åŒºåˆ«ï¼š"><code>useReducer</code>å’Œ<code>redux</code>çš„åŒºåˆ«ï¼š</h2>
<p><code>useReducer</code>åˆ›é€ çš„<code>state</code>æ˜¯åŸºäºå„ä¸ªç»„ä»¶çš„ï¼Œç»„ä»¶ä¸ç»„ä»¶ä¹‹é—´çš„stateæ˜¯ç‹¬ç«‹çš„ï¼Œæ— æ³•å…±äº«ï¼Œå¦‚æœéœ€è¦ä¼ é€’åªèƒ½é€šè¿‡<code>props</code>æˆ–è€…<code>context</code>ï¼Œæ‰€ä»¥ï¼Œå°±åƒå®ƒçš„åå­—ä¸€æ ·çš„ï¼Œ<code>useReducer</code>å°±æ˜¯æ–¹ä¾¿å¼€å‘è€…å»ä½¿ç”¨è‡ªå·±çš„<code>reducer</code>æ¥ç®¡ç†ç»„ä»¶çº§åˆ«çš„<code>state</code>ã€‚</p>
<p><code>redux</code>åˆ™å¯ä»¥ç‹¬ç«‹äºç»„ä»¶ä¹‹å¤–ï¼Œåˆ›é€ ä¸€ä¸ªå…¨å±€çš„çŠ¶æ€ç®¡ç†ï¼Œè¿™ä¸ªå…¨å±€çš„çŠ¶æ€å¯ä»¥å’Œå„ä¸ªç»„ä»¶é€šè¿‡<code>mapStateToProps</code>å’Œ<code>mapDispatchToProps</code>æ¥é€šä¿¡ã€‚</p>
<h2 id="æ€è·¯ï¼š">æ€è·¯ï¼š</h2>
<p>çŸ¥é“åŒºåˆ«ä¹‹åï¼Œå°±ä¼šæœ‰ä¸€ä¸ªæƒ³æ³•ï¼šå¦‚ä½•åŸºäºhooksçš„ç‰¹æ€§æ¥åˆ›é€ ä¸€ä¸ªç®€æ´çš„å…¨å±€çŠ¶æ€ï¼Œå¹¶ä¸”å„ä¸ªå­ç»„ä»¶å¯ä»¥è§¦è¾¾åˆ°è¿™ä¸ªçŠ¶æ€å‘¢ï¼Ÿå—¯ã€‚ã€‚åœ¨æ ¹ç»„ä»¶å»ºç«‹ä¸€ä¸ªå…¨å±€stateå’Œå„ä¸ªdispatchçš„æ”¶å£ï¼Œç„¶åé€šè¿‡react contextæ¥å°†å…¨å±€çš„stateå’Œå…¨å±€dispatchä¸‹å‘ç»™å„ä¸ªå­ç»„ä»¶æˆ–è®¸æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡usereduceråœ¨æ ¹ç»„ä»¶ä¸Šåˆ›å»ºglobaldispatchå’Œglobalstateï¼š">ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡useReduceråœ¨æ ¹ç»„ä»¶ä¸Šåˆ›å»ºglobalDispatchå’ŒglobalStateï¼š</h3>
<pre><code class="jsx language-jsx">// app.jsx
import React, { useReducer } from "react";
import { addTodo, completeTodo, setVisibilityFilter } from "../actions";
import { visibilityFilter, todos } from "./reducers";

function App() {
  const [filters, dispatchFilter] = useReducer(visibilityFilter, "SHOW_ALL");
  const [todoList, dispatchTodos] = useReducer(todos, []);

  // è¿™é‡Œå¯ä»¥åˆ›å»ºä¸€ä¸ª global dispatch function å’Œ global state
  const globalDispatch = action =&gt;
    [dispatchFilter, dispatchTodos].forEach(fn =&gt; fn(action));
  const globalState = {
    filters,
    todoList
  };

  return (
    &lt;div&gt;
      ...
    &lt;/div&gt;
  );
}

export default App;</code></pre>
<h3 id="ç¬¬äºŒæ­¥ï¼š-åˆ›å»ºcontextå¹¶åœ¨æ ¹ç»„ä»¶ä¸Šä¼ å…¥globalstateå’Œglobaldispatch">ç¬¬äºŒæ­¥ï¼š åˆ›å»ºcontextå¹¶åœ¨æ ¹ç»„ä»¶ä¸Šä¼ å…¥<code>globalState</code>å’Œ<code>globalDispatch</code></h3>
<p>è¿™é‡Œçš„contextçš„ä½œç”¨æ˜¯èƒ½å¤Ÿè®©æ ‘ä¸Šçš„ä»»æ„ä½ç½®çš„ç»„ä»¶èƒ½é€šè¿‡<code>useContext</code>è·å–åˆ°<code>globalState</code>å’Œ<code>globalDispatch</code>å‡½æ•°</p>
<pre><code class="jsx language-jsx">// context.jsx
import React from "react";

export const StateContext = React.createContext({});

export const DispatchContext = React.createContext(null);</code></pre>
<pre><code class="jsx language-jsx">// app.jsx
import React, { useReducer } from "react";
import { addTodo, completeTodo, setVisibilityFilter } from "../actions";
import { visibilityFilter, todos } from "./reducers";

function App() {
  const [filters, dispatchFilter] = useReducer(visibilityFilter, "SHOW_ALL");
  const [todoList, dispatchTodos] = useReducer(todos, []);

  // è¿™é‡Œå¯ä»¥åˆ›å»ºä¸€ä¸ª global dispatch function å’Œ global state
  const globalDispatch = action =&gt;
    [dispatchFilter, dispatchTodos].forEach(fn =&gt; fn(action));
  const globalState = {
    filters,
    todoList
  };

  return (
    &lt;DispatchContext.Provider value={globalDispatch}&gt;
      &lt;StateContext.Provider value={globalState}&gt;{children}&lt;/StateContext.Provider&gt;
    &lt;/DispatchContext.Provider&gt;
  );
}

export default App;</code></pre>
<h3 id="åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨globalstateå’Œglobaldispatchï¼š">åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨globalStateå’ŒglobalDispatchï¼š</h3>
<p>ç„¶åé€šè¿‡<code>useContext</code>çš„hookï¼Œæˆ‘ä»¬å°±èƒ½åœ¨ä»»æ„å­ç»„ä»¶ä¸­è·å–åˆ°<code>state</code>å’Œ<code>dispatch</code>äº†ï¼Œç›¸å½“äºreduxçš„<code>mapStateToProps</code>å’Œ<code>mapDispatchToProps</code>çš„ä½œç”¨</p>
<pre><code class="jsx language-jsx">import React from "react";
import { completeTodo } from "./actions";
import { StateContext, DispatchContext } from "./context.js";

export default () =&gt; {
  const state = React.useContext(StateContext);
  const dispatch = React.useContext(DispatchContext);
  const { todoList } = state;
  return (
    &lt;ul&gt;
      {todoList.map(({ text, completed }, index) =&gt; {
        return (
          &lt;li
            onClick={() =&gt; {
              dispatch(completeTodo(index));
            }}
            className={`${completed ? "done" : "todo"}`}
          &gt;
            {text}
          &lt;/li&gt;
        );
      })}
    &lt;/ul&gt;
  );
};</code></pre>
<h3 id="æ€»ç»“å’Œå»ºè®®ï¼š">æ€»ç»“å’Œå»ºè®®ï¼š</h3>
<p>é€šè¿‡ä»¥ä¸Šå‡ æ­¥å°±èƒ½è·å¾—ä¸€ä¸ªå…¨å±€çŠ¶æ€ç®¡ç†çš„åŠŸèƒ½ï¼Œé’ˆå¯¹ä¸­å°å‹ç½‘ç«™ï¼Œå¯ä»¥ä¸å†éœ€è¦reduxã€‚<br />
æˆ‘å·²ç»å°è£…äº†è¿™ä¸ªå°å·¥å…·ï¼Œæœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œè¦†ç›–ç‡ï¼Œä¸”å¾—ç›Šäºtypescriptçš„é«˜çº§ç±»å‹ï¼Œèƒ½å¤Ÿç»™å‡ºæ™ºèƒ½çš„IDEæç¤ºï¼Œè¯¦è§<a href="https://github.com/ahungrynoob/use-root-reducer">use-root-reducer</a>ï¼Œæ¬¢è¿pr~</p>